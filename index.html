<!DOCTYPE html>
<html lang="en">
  <head>
    <title>SELMA Demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
      if(location.hash === '#yannick') {
        location.hash = '';
        // document.querySelector('link').remove();
        document.write(`
          <link rel="stylesheet" href="dist-yannick/index.dcc93541.css">
          <script type="text/javascript">var serverUrl="http://ns334712.ip-178-33-239.eu/api";<\/script>
          <script type="module" src="dist-yannick/index.e448407d.js"><\/script>
        `);
      }
    </script>
    <link rel="stylesheet" href="dist/style.css">
    <style>
      .hidden-x {
        display: none;
      }
    </style>
  </head>
  <body class="hidden-x">
    <div style="position: absolute; width: 100px; left: 0px; right: auto; top: 0px; bottom: 0px">
      <div style="padding: 10px">
        <button class="btn btn-outline-secondary" onclick="window.open('/', '_self')"><i class="bi bi-list-ul"></i></button>
        &nbsp;
      </div>
      <div class="left-icons">
        <div class="resource">
          <ul>
            <li><a href="#" target="_blank">Clusters</a></li>
            <li><a href="#" target="_blank">Topics</a></li>
            <li><a href="#" target="_blank">Search</a></li>
          </ul>
        </div>
      </div>
      <br/>
      <div class="left-icons">
        <div class="resource">
          <a href="http://194.8.1.235:10000/swagger/index.html" target="_blank"><img class="icon" src="prib.png" _style="height: 46px; top: 0px; right: 400px; position: absolute"></a>
          <ul>
            <li><a href="http://194.8.1.235:54322/" target="_blank">SQL DB</a></li>
            <li><a href="http://194.8.1.235:15672/" target="_blank">RabbitMQ</a></li>
          </ul>
        </div>
        <div class="resource">
          <a href="/#yannick" target="_blank"><img class="icon" src="workflow-mark-indigo-600.svg" _style="height: 46px; top: 0px; right: 250px; position: absolute"></a>
          <ul>
            <li><a href="#" target="_blank" target="_blank">ASR</a></li>
            <li><a href="#" target="_blank">Voice Synthesis</a></li>
          </ul>
        </div>
        <div class="resource">
          <a href="http://194.8.1.235:7789/" target="_blank"><img class="icon" src="http://194.8.1.235:7789/api/files/099d6ceb-a978-4d6f-b37c-431d85fefc9e/content?token=7654321"></a>
          <ul>
            <li><a href="#" target="_blank">Media Server</a></li>
            <li><a href="#" target="_blank">NEL</a></li>
          </ul>
        </div>
        <div class="resource">
          <a href="#" target="_blank"><img class="icon" src="fraunhofer.png"></a>
          <ul>
            <li><a href="#" target="_blank">XY</a></li>
            <li><a href="#" target="_blank">AB</a></li>
          </ul>
        </div>
        <div class="resource">
          <a href="https://app.plain-x.com/" target="_blank"><img class="icon" src="plainX.png"></a>
          <ul>
            <li><a href="#" target="_blank">XY</a></li>
            <li><a href="#" target="_blank">AB</a></li>
          </ul>
        </div>
        <div class="resource">
          <a href="https://app.monitio.com/" target="_blank"><img class="icon" src="monitio.png"></a>
          <ul>
            <li><a href="#" target="_blank">XY</a></li>
            <li><a href="#" target="_blank">AB</a></li>
          </ul>
        </div>
        <div class="resource">
          <a href="https://p.dw.com/p/3dJvX" target="_blank"><img class="icon" src="dw.png"></a>
          <ul>
            <li><a href="http://194.8.1.230:7791" target="_blank">GourmetTerminal</a></li>
            <li><a href="http://194.8.1.235:9000/test.html" target="_blank">JS CORS test</a></li>
          </ul>
        </div>
        <div class="resource">
          <a href="https://translate.gourmet.newslabs.co" target="_blank"><img class="icon" src="Gourmet.png"></a>
          <ul>
            <li><a href="https://gourmet-project.eu" target="_blank">GourmetProject</a></li>
            <li><a href="http://194.8.1.235:9000/gourmet.log" target="_blank">TokenQueue Log</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div style="position: absolute; left: 100px; right: 0px; top: 0px; bottom: 0px">
    <div style="margin: 10px; position: relative">
      <!--
      <button class="btn btn-outline-secondary" onclick="window.open('/', '_self')"><i class="bi bi-list-ul"></i></button>
      &nbsp;
      -->
      <button class="btn btn-outline-secondary" id="upload-file-x">Save</button>
      &nbsp;
      <button class="btn btn-outline-secondary" id="upload-file">UploadFleeting<div style="position: absolute; top: auto; bottom: 0px; font-size: 8px; color: gray">Max 8 min., 10M/day</div></button>
      <input type="file" capture id="file-selector" style="display: none">
      <span id="status"></span>
      <div style="display: inline-block">
      <div id="top-spinner">
        <div class="spinner-border text-danger" role="status">
          <span class="visually-hidden"></span>
        </div>
        <span class="label">
          Processing...
        </span>
      </div>
      </div>
      <div style="position: relative; left: 10px; display: inline-block; top: 4px">
        <!-- Machine Translation&nbsp; -->
        <select id="mt-src-lang">
          <option value="lv">Latvian</option>
          <option value="sq">Albanian</option>
          <option value="am">Amharic</option>
          <option value="ar">Arabic</option>
          <option value="bn">Bengali</option>
          <option value="bs">Bosnian</option>
          <option value="bg">Bulgarian</option>
          <option value="zh">Chinese Mandarin</option>
          <option value="hr">Croatian</option>
          <option value="en">English</option>
          <option value="fa">Farsi</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="el">Greek</option>
          <option value="ha">Hausa</option>
          <option value="hi">Hindi</option>
          <option value="hu">Hungarian</option>
          <option value="id">Indonesian</option>
          <option value="it">Italian</option>
          <option value="mk">Macedonian</option>
          <option value="pa">Panjabi</option>
          <option value="ps">Pashto</option>
          <option value="pl">Polish</option>
          <option value="pt">Portuguese</option>
          <option value="ro">Romanian</option>
          <option value="ru">Russian</option>
          <option value="sr">Serbian</option>
          <option value="es">Spanish</option>
          <option value="sw">Swahili</option>
          <option value="ta">Tamil</option>
          <option value="tr">Turkish</option>
          <option value="uk">Ukrainian</option>
          <option value="ur">Urdu</option>
        </select>
        <!-- &horbar;&gt; -->
        &#10142;
        <select id="mt-dst-lang">
          <option value="en">English</option>
          <option value="sq">Albanian</option>
          <option value="am">Amharic</option>
          <option value="ar">Arabic</option>
          <option value="bn">Bengali</option>
          <option value="bs">Bosnian</option>
          <option value="bg">Bulgarian</option>
          <option value="zh">Chinese Mandarin</option>
          <option value="hr">Croatian</option>
          <option value="fa">Farsi</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="el">Greek</option>
          <option value="ha">Hausa</option>
          <option value="hi">Hindi</option>
          <option value="hu">Hungarian</option>
          <option value="id">Indonesian</option>
          <option value="it">Italian</option>
          <option value="lv">Latvian</option>
          <option value="mk">Macedonian</option>
          <option value="pa">Panjabi</option>
          <option value="ps">Pashto</option>
          <option value="pl">Polish</option>
          <option value="pt">Portuguese</option>
          <option value="ro">Romanian</option>
          <option value="ru">Russian</option>
          <option value="sr">Serbian</option>
          <option value="es">Spanish</option>
          <option value="sw">Swahili</option>
          <option value="ta">Tamil</option>
          <option value="tr">Turkish</option>
          <option value="uk">Ukrainian</option>
          <option value="ur">Urdu</option>
        </select>
        &nbsp;&nbsp;
        <button class="btn btn-outline-secondary" id="transcribe">TRanscribe</button>
        <button class="btn btn-outline-secondary" id="translate">TransLate</button>
        <button class="btn btn-outline-secondary" id="voiceover">VoiceOver</button>
      </div>
      <style>
        img.icon {
          height: 26px;
          top: 0px;
        }
        div.icons {
          display: inline-block;
          position: absolute;
          right: 10px;
        }
        div.resource {
          display: inline-block;
          padding-left: 30px;
        }
        div.resource > ul {
          font-size: 0.6em;
          padding-left: 12px;
        }
        div.left-icons > div.resource {
          display: block;
          padding-left: 10px;
        }
      </style>
      <div class="icons">
        <div class="resource">
          <a href="https://confluence.dw.com/display/SELMA/Home" target="_blank"><img class="icon" src="confluence.png" _style="height: 46px; top: 0px; right: 10px; position: absolute"></a>
          <ul>
            <li><a href="https://github.com/SELMA-project" target="_blank">GitHub</a></li>
            <li><a href="https://hub.docker.com/orgs/selmaproject/repositories" target="_blank">DockerHub</a></li>
          </ul>
        </div>
        <div class="resource">
          <a href="" target="_blank"><img class="icon" src="usbflash.png" _style="height: 46px; top: 0px; right: 10px; position: absolute"></a>
          <ul>
            <li><a href="#" target="_blank">AWS Cloud</a></li>
            <li><a href="#" target="_blank">Boot Flash</a></li>
          </ul>
        </div>
        <div class="resource">
          <a href="http://194.8.1.235:7791/" target="_blank"><img class="icon" src="jupyter.png" _style="height: 46px; top: 0px; right: 10px; position: absolute"></a>
          <ul>
            <li><a href="http://194.8.1.225:7788" target="_blank">CUDA notebook</a></li>
            <li><a href="https://colab.research.google.com" target="_blank">Colab notebook</a></li>
          </ul>
        </div>
        <!--
        <div class="resource">
          <a href="http://194.8.1.235:7789/" target="_blank"><img class="icon" src="pinitree.png"></a>
          <ul>
            <li><a href="#" target="_blank">Media Server</a></li>
            <li><a href="#" target="_blank">NEL</a></li>
          </ul>
        </div>
        -->
        <!--
        <div class="resource">
          <a href="http://194.8.1.235:10000/swagger/index.html" target="_blank"><img class="icon" src="prib.png" _style="height: 46px; top: 0px; right: 400px; position: absolute"></a>
          <ul>
            <li><a href="http://194.8.1.235:54322/" target="_blank">SQL DB</a></li>
            <li><a href="http://194.8.1.235:15672/" target="_blank">RabbitMQ</a></li>
          </ul>
        </div>
        -->
        <!--
        <div class="resource">
          <a href="/#yannick" target="_blank"><img class="icon" src="workflow-mark-indigo-600.svg" _style="height: 46px; top: 0px; right: 250px; position: absolute"></a>
          <ul>
            <li><a href="#" target="_blank" target="_blank">ASR</a></li>
            <li><a href="#" target="_blank">Voice Synthesis</a></li>
          </ul>
        </div>
        -->
        <div class="resource">
          <a href="http://194.8.1.235:9000/api/workers" target="_blank"><img class="icon" src="logo.png" _style="height: 46px; top: 0px; right: 10px; position: absolute"></a>
          <ul>
            <li><a href="http://194.8.1.235:7789/?token=7654321" target="_blank">Add NLP Image</a></li>
            <li><a href="http://selma-project.eu/" target="_blank">SELMA Project</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div id="app"></div>
    <div id="app-mt"></div>
    </div>
    <script type="module" defer>
      import init from './dist/ruta.es.js';

      const app = init('#app');
      const appMT = init('#app-mt');
      const spinner = document.querySelector('#top-spinner')

      function uploadFile(event) {
        const fileSelector = document.querySelector('#file-selector')
        fileSelector.click();
      }

      async function fileSelected(event) {
        const file = event.target.files[0];
        const status = document.querySelector('#status')
        // reset file selector: https://stackoverflow.com/a/35323290
        event.target.value = ''
        if(!/safari/i.test(navigator.userAgent)){
          event.target.type = ''
          event.target.type = 'file'
        }

        if(!file) {
          return;
        }

        spinner.style.display = 'inline-block';

        app.load({ audio: null, transcript: {} });
        appMT.load({ audio: null, transcript: {} });

        app.load({ audio: file });
        appMT.load({ audio: file });

        const formData = new FormData();
        formData.append(file.name, file);
        const acceptJSONHeaders = { 'Accept': 'application/json' };
        const response = await fetch(`https://selma.ailab.lv/api/upload`, { method: 'POST', body: formData, headers: acceptJSONHeaders });
        const result = await response.json();
        const { transcript, translated } = result;

        spinner.style.display = 'none';

        app.load({ transcript });
        appMT.load({ transcript: translated });
      }

      // async function sourceLanguageChanged(event) {
      //   console.log('source language:', event.target.value);
      // }
      //
      // async function targetLanguageChanged(event) {
      //   console.log('target language:', event.target.value);
      // }

      async function translate(event) {
        // console.log('TRANSLATE', event);
        const sourceLang = document.querySelector('#mt-src-lang').value;
        const targetLang = document.querySelector('#mt-dst-lang').value;
        // console.log('source language:', sourceLang);
        // console.log('target language:', targetLang);
        const jsonHeaders = { 'Accept': 'application/json', 'Content-Type': 'application/json' };
        appMT.load({ transcript: {} });
        spinner.style.display = 'inline-block';
        const response = await fetch(`https://selma.ailab.lv/api/translate?src=${sourceLang}&dst=${targetLang}`, { method: 'POST', body: JSON.stringify(app.transcript), headers: jsonHeaders });
        const result = await response.json();
        spinner.style.display = 'none';
        // console.log('translated:', result);
        appMT.load({ transcript: result });
      }
      document.addEventListener("DOMContentLoaded", () => {
        app.load({ audio: null, transcript: { paragraphs: [] } });
        document.querySelector('body').classList.remove('hidden-x');
        document.querySelector('#upload-file').addEventListener('click', uploadFile);
        document.querySelector('#file-selector').addEventListener('change', fileSelected);
        // document.querySelector('#mt-src-lang').addEventListener('change', sourceLanguageChanged);
        // document.querySelector('#mt-dst-lang').addEventListener('change', targetLanguageChanged);
        document.querySelector('#translate').addEventListener('click', translate);
      });
    </script>
    <style>
      html, body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        margin: 0px;
        padding: 0px;
        position: relative;
      }
      #app {
        /* width: 100%; */
        /* height: 100%; */
        margin: 10px;
        position: absolute;
        top: 52px;
        bottom: 0px;
        left: 0px;
        right: 0px;
        overflow: visible;
        right: 50%;
      }
      #app-mt {
        /* width: 100%; */
        /* height: 100%; */
        margin: 10px;
        position: absolute;
        top: 52px;
        bottom: 0px;
        left: 0px;
        right: 0px;
        overflow: visible;
        left: 50%;
      }
      .editor-wrapper > .header {
        display: none;
      }
      #top-spinner {
        /* display: inline-block; */
        display: none;
        position: absolute;
        /* position: relative; */
        top: 4px;
        left: 120px;
        width: 34px;
        height: 34px;
      }
      #top-spinner > .label {
        display: none;
        position: relative;
        left: 8px;
        top: -6px;
      }
    </style>
  </body>
</html>
